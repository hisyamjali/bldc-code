#include <ArduinoJson.h>
//#######################################
//#######################################
// GPIO mappings for Arduino Mega 2560
//#######################################
int m1_EL_Start_Stop=3;  //EL 
int m1_Signal_hall=4;   // Signal - Hall sensor
int m1_ZF_Direction=9;  // ZF 
int m1_VR_speed=5;    //VR 
int m2_EL_Start_Stop=2;  //EL 
int m2_Signal_hall=7;   // Signal - Hall sensor
int m2_ZF_Direction=8;  // ZF 
int m2_VR_speed=6;    //VR 
//#######################################
//#######################################
int pos=0;int steps=0;int speed1=50; int speed2=25;
int val;
//#######################################
//#######################################

void setup() {

// put your setup code here, to run once:
Serial.begin(115200);

//wheel left - Setup pin mode
pinMode(m1_EL_Start_Stop, OUTPUT);//stop/start - EL 
pinMode(m1_Signal_hall, INPUT);   //plus       - Signal  
pinMode(m1_ZF_Direction, OUTPUT); //direction  - ZF 

//wheel right 
pinMode(m2_EL_Start_Stop, OUTPUT);//stop/start - EL 
pinMode(m2_Signal_hall, INPUT);   //plus       - Signal  
pinMode(m2_ZF_Direction, OUTPUT); //direction  - ZF 


}

void loop() 
{
  val=Serial.read();

  if(val=='1')
  {
    forward();
  }

  else if(val=='2')
  {
    backward();
  }
  
  else if(val=='3')
  {
    right();
  }

  else if(val=='4')
  {
    left();
  }

  else
  {
    Stop();
  }
}

void Stop(){ 
digitalWrite(m1_EL_Start_Stop,LOW);
digitalWrite(m2_EL_Start_Stop,LOW);
}

void forward(){
      analogWrite(m1_VR_speed, speed1);
      digitalWrite(m1_EL_Start_Stop,LOW);
      delay(1000);
      digitalWrite(m1_ZF_Direction,HIGH);
      delay(1000);
      digitalWrite(m1_EL_Start_Stop,HIGH);

      analogWrite(m2_VR_speed, speed1);
      digitalWrite(m2_EL_Start_Stop,LOW);
      delay(1000);
      digitalWrite(m2_ZF_Direction,HIGH);
      delay(1000);
      digitalWrite(m2_EL_Start_Stop,HIGH);
}

void backward(){
      analogWrite(m1_VR_speed, speed1);
      digitalWrite(m1_EL_Start_Stop,LOW);
      delay(1000);
      digitalWrite(m1_ZF_Direction,LOW);
      delay(1000);
      digitalWrite(m1_EL_Start_Stop,HIGH);

      analogWrite(m2_VR_speed, speed1);
      digitalWrite(m2_EL_Start_Stop,LOW);
      delay(1000);
      digitalWrite(m2_ZF_Direction,LOW);
      delay(1000);
      digitalWrite(m2_EL_Start_Stop,HIGH);
}

void right()
{
      analogWrite(m1_VR_speed, speed1);
      digitalWrite(m1_EL_Start_Stop,LOW);
      delay(1000);
      digitalWrite(m1_ZF_Direction,HIGH);
      delay(1000);
      digitalWrite(m1_EL_Start_Stop,HIGH);
      
      analogWrite(m2_VR_speed, speed2);
      digitalWrite(m2_EL_Start_Stop,LOW);
      delay(1000);
      digitalWrite(m2_ZF_Direction,HIGH);
      delay(1000);
      digitalWrite(m2_EL_Start_Stop,HIGH);
      
}

void left()
{
  
      analogWrite(m1_VR_speed, speed2);
      digitalWrite(m1_EL_Start_Stop,LOW);
      delay(1000);
      digitalWrite(m1_ZF_Direction,HIGH);
      delay(1000);
      digitalWrite(m1_EL_Start_Stop,HIGH);

      
      analogWrite(m2_VR_speed, speed1);
      digitalWrite(m2_EL_Start_Stop,LOW);
      delay(1000);
      digitalWrite(m2_ZF_Direction,HIGH);
      delay(1000);
      digitalWrite(m2_EL_Start_Stop,HIGH);
}
